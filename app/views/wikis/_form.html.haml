- if @wiki.new_record?
  - object = [@event, @wiki]
- else
  - object = @wiki
- event = @event || @wiki.event

%div{'ng-controller' => 'WikiCtrl', 'ng-init' => "wiki = #{@wiki.to_json}"}
  = simple_form_for object, :html => { class: 'form-vertical' } do |f|
    = f.error_notification

    .form-inputs
      = f.input :title, input_html: { :'ng-model' => 'wiki.title', class: 'input-xxlarge' }
      = f.input :name, input_html: { value: '{{ name() }}' }
      = f.input :wiki_id, collection: [event], as: :grouped_select, group_method: :wikis
      = f.label :content
      .tabs
        %ul.nav.nav-pills
          %li.active
            %a{href: "#edit", 'data-toggle' => "pill"}= t :edit_mode
          %li
            %a{href: "#preview", 'data-toggle' => "pill"}= t :preview_mode
        #edit.tab.active
          = f.input :content, label: false, input_html: { :'ng-model' => 'wiki.content' }
        #preview.tab
          %div{:'ng-bind-html-unsafe' => "preview()"}

    .form-actions
      = f.button :submit, label: t(:subscribe), class: 'btn btn-primary'
      = link_to_back path: event_wikis_path(event) if can? :index, Subscription
